<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Imagen Interactiva y Movible</title>
    <style>
        /* 1. Estilos para el contenedor de la imagen */
        .movable-resizable-container {
            position: absolute; /* CLAVE: Permite moverlo libremente con top/left */
            top: 50px;
            left: 50px;
            width: 200px; /* Tamaño inicial */
            height: 200px; /* Tamaño inicial */
            border: 2px solid #3498db; /* Borde para visualizar la zona de agarre */
            cursor: grab; /* Indica que se puede arrastrar */
            box-sizing: border-box; /* Asegura que el padding/border no altere el width/height */
            /* Es importante evitar que el texto se pueda seleccionar al arrastrar */
            user-select: none;
        }

        /* 2. Estilos para la imagen dentro del contenedor */
        .movable-resizable-container img {
            width: 100%;
            height: 100%;
            display: block;
            object-fit: cover; /* Asegura que la imagen cubra el contenedor */
        }

        /* 3. Estilo para el "asa" o "tirador" de redimensionamiento */
        .resizer {
            width: 15px;
            height: 15px;
            background: #2ecc71; /* Un color distintivo */
            position: absolute;
            right: -7px; /* Lo coloca a la derecha del borde */
            bottom: -7px; /* Lo coloca en la parte inferior del borde */
            cursor: nwse-resize; /* Cursor para indicar redimensionamiento diagonal */
            border-radius: 50%; /* Lo hace circular */
        }
    </style>
</head>
<body>

    <div id="imageContainer" class="movable-resizable-container">
        <img src="https://www.are.na/block/41279409" alt="Foto proporcionada por el usuario">
        <div class="resizer" id="resizerHandle"></div>
    </div>

    <script>
        // --- 1. CONFIGURACIÓN INICIAL ---
        const container = document.getElementById('imageContainer');
        const resizer = document.getElementById('resizerHandle');
        let isDragging = false; // Bandera para arrastre
        let isResizing = false; // Bandera para redimensionamiento
        let currentX; // Posición X actual del ratón
        let currentY; // Posición Y actual del ratón
        let initialX; // Posición X inicial del ratón
        let initialY; // Posición Y inicial del ratón
        let xOffset = 0; // Desplazamiento X del contenedor
        let yOffset = 0; // Desplazamiento Y del contenedor

        // --- 2. FUNCIONES DE MANEJO DE EVENTOS ---

        // Inicia el ARRASTRE
        function dragStart(e) {
            // Solo comienza a arrastrar si no estamos en el redimensionador
            if (e.target.id !== 'resizerHandle') {
                e.preventDefault();
                isDragging = true;
                initialX = e.clientX - xOffset;
                initialY = e.clientY - yOffset;
                // Cambia el cursor para indicar arrastre
                container.style.cursor = 'grabbing';
            }
        }

        // Ejecuta el ARRASTRE
        function drag(e) {
            if (isDragging) {
                e.preventDefault();
                currentX = e.clientX - initialX;
                currentY = e.clientY - initialY;

                xOffset = currentX;
                yOffset = currentY;

                setTranslate(currentX, currentY, container);
            } else if (isResizing) {
                // Si estamos redimensionando
                let newWidth = e.clientX - container.offsetLeft;
                let newHeight = e.clientY - container.offsetTop;

                // Asegura un tamaño mínimo
                if (newWidth > 50) container.style.width = newWidth + 'px';
                if (newHeight > 50) container.style.height = newHeight + 'px';
            }
        }

        // Finaliza el ARRASTRE/REDIMENSIONAMIENTO
        function dragEnd(e) {
            initialX = currentX;
            initialY = currentY;
            isDragging = false;
            isResizing = false;
            // Restablece el cursor
            container.style.cursor = 'grab';
        }

        // Inicia el REDIMENSIONAMIENTO
        function resizeStart(e) {
            e.preventDefault();
            e.stopPropagation(); // Evita que el evento se propague al contenedor y active el arrastre
            isResizing = true;
        }

        // Función auxiliar para aplicar el movimiento
        function setTranslate(xPos, yPos, el) {
            el.style.transform = "translate3d(" + xPos + "px, " + yPos + "px, 0)";
        }

        // --- 3. ASIGNACIÓN DE EVENT LISTENERS ---

        // Eventos para el contenedor (Arrastre)
        container.addEventListener("mousedown", dragStart, false);
        document.addEventListener("mouseup", dragEnd, false);
        document.addEventListener("mousemove", drag, false);
        
        // Evento para el redimensionador (Redimensionamiento)
        resizer.addEventListener("mousedown", resizeStart, false);

    </script>
</body>
</html>
